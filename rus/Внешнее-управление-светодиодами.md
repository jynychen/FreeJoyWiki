
[На стартовую страницу](../README.md) | [Предыдущий раздел](Подключение-светодиодов.md)

## Внешнее управление светодиодами

FreeJoy поддерживает управление до 24 светодиодами из программного обеспечения на стороне хоста с помощью HID-отчетов. Эта функция позволяет сторонним программам (например, играм или инструментам телеметрии) управлять светодиодами на вашем устройстве.

### Настройка

Чтобы включить внешнее управление для конкретного светодиода:
1. Перейдите на вкладку **LEDs** в FreeJoy Configurator.
2. Для нужного светодиода установите флажок **External** (Внешнее).

![L3](../images/L3.png)

Если флажок **External** установлен, светодиод будет управляться только программным обеспечением хоста.

### Протокол

Светодиоды управляются путем отправки выходного HID-отчета (HID Output Report) на второе HID-устройство (Usage Page: `0xFF00`, Interface: `1`).

| Байт | Значение | Описание |
| --- | --- | --- |
| 0 | 6 | Report ID |
| 1-4 | Битовая маска | Состояния светодиодов (1 бит на светодиод, 4 байта, little-endian) |

Битовая маска позволяет управлять всеми 24 светодиодами одновременно. Бит 0 маски соответствует светодиоду 1, бит 1 — светодиоду 2 и так далее.

### Пример на Python

Для управления светодиодами из Python можно использовать библиотеку `hidapi`:

```python
import hid

# FreeJoy USB VID/PID
VID = 0x0483
PID = 0x5757

def set_freejoy_leds(led_mask):
    # Поиск нужного интерфейса (Interface 1 для светодиодов)
    target_path = None
    for device in hid.enumerate(VID, PID):
        if device['interface_number'] == 1:
            target_path = device['path']
            break

    if not target_path:
        print("FreeJoy interface 1 not found")
        return

    try:
        device = hid.device()
        device.open_path(target_path)

        # Report ID 6 + 4 байта битовой маски (little-endian)
        report = [0x06] + list(led_mask.to_bytes(4, 'little'))
        device.write(report)
        device.close()
    except Exception as e:
        print(f"Error: {e}")

# Пример: Включить светодиоды 1 и 3 (битовая маска 0x05)
set_freejoy_leds(0x00000005)
```

[На стартовую страницу](../README.md) | [Предыдущий раздел](Подключение-светодиодов.md)
